<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <!-- Google Tag Manager -->
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-5ZQZCG5P');</script>
    <!-- End Google Tag Manager -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã‚¹ãƒãƒ¼ãƒˆå‰²ã‚Šå‹˜ | ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨å‰²ã‚Šå‹˜è¨ˆç®—ãƒ„ãƒ¼ãƒ«</title>
    <meta name="description" content="å®Œå…¨ç„¡æ–™ã§ã‚¹ãƒãƒ›å¯¾å¿œã€‚10å††ãƒ»100å††å˜ä½ã®ç«¯æ•°èª¿æ•´ã‚„LINEå…±æœ‰ãŒã§ãã‚‹é«˜æ©Ÿèƒ½ãªå‰²ã‚Šå‹˜è¨ˆç®—ãƒ„ãƒ¼ãƒ«ã€‚åˆã‚³ãƒ³ã€é£²ã¿ä¼šã€æ—…è¡Œã®ç²¾ç®—ã‚’ã‚¹ãƒãƒ¼ãƒˆã«ã€‚">

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "ã‚¹ãƒãƒ¼ãƒˆå‰²ã‚Šå‹˜",
      "applicationCategory": "FinanceApplication",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "JPY"
      }
    }
    </script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans JP', 'sans-serif'],
                    },
                    screens: {
                        'xs': '475px',
                    }
                }
            }
        }
    </script>

    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/lucide-react@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&family=Noto+Sans+JP:wght@400;700&display=swap');

        :root {
            --ios-safe-bottom: env(safe-area-inset-bottom);
        }

        body {
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: contain;
            font-family: 'Outfit', 'Noto Sans JP', sans-serif;
            font-size: 16px;
            /* Prevents auto-zoom on iOS */
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* 48px Touch Target compliance */
        input,
        button,
        select {
            min-height: 48px;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .shadow-premium {
            box-shadow: 0 10px 30px -10px rgba(79, 70, 229, 0.15);
        }

        .animate-slide-up {
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="bg-gray-50">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5ZQZCG5P" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div id="root"></div>

    <script>
        // Lucide Icons initialization helper (Robust version)
        window.getIcon = function (name) {
            // Priority 1: Check LucideReact (React Components)
            if (window.LucideReact && window.LucideReact[name]) return window.LucideReact[name];

            // Priority 2: Check Lucide (Core Data) and wrap it
            if (window.lucide && window.lucide[name]) {
                const iconData = window.lucide[name];

                // If it's the raw data array [tag, attrs, children]
                if (Array.isArray(iconData)) {
                    return function (props) {
                        const renderNode = (node, key) => {
                            if (!node || !Array.isArray(node)) return null;
                            const [tag, attrs, children] = node;
                            const combinedAttrs = key !== undefined ? { ...attrs, key } : attrs;
                            return React.createElement(tag, combinedAttrs,
                                children ? children.map((c, i) => renderNode(c, i)) : null
                            );
                        };

                        // The iconData from Lucide core is typically the array of children for the SVG
                        // We need to wrap it in an SVG tag
                        return React.createElement('svg', {
                            xmlns: 'http://www.w3.org/2000/svg',
                            width: '24',
                            height: '24',
                            viewBox: '0 0 24 24',
                            fill: 'none',
                            stroke: 'currentColor',
                            strokeWidth: '2',
                            strokeLinecap: 'round',
                            strokeLinejoin: 'round',
                            ...props
                        }, iconData.map((c, i) => renderNode(c, i)));
                    };
                }

                // If it's somehow already a component or function
                if (typeof iconData === 'function') return iconData;
            }

            // Priority 3: Last resort fallback (Emoji based or safe div)
            const fallbacks = {
                Wallet: 'ğŸ’°',
                Users: 'ğŸ‘¥',
                Plus: 'ï¼‹',
                Trash2: 'ğŸ—‘ï¸',
                ChevronDown: 'â–¼',
                Check: 'âœ…'
            };

            return (props) => React.createElement('span', {
                ...props,
                style: { display: 'inline-flex', alignItems: 'center', justifyContent: 'center', ...props.style }
            }, fallbacks[name] || 'â€¢');
        };

        // Pre-define icons used in the app as ready-to-use components
        window.Icons = {
            Users: (props) => React.createElement(window.getIcon('Users'), { className: 'w-5 h-5 text-indigo-500', ...props }),
            Plus: (props) => React.createElement(window.getIcon('Plus'), { className: 'w-3 h-3', ...props }),
            Trash2: (props) => React.createElement(window.getIcon('Trash2'), { className: 'w-5 h-5', ...props }),
            Wallet: (props) => React.createElement(window.getIcon('Wallet'), { className: 'w-6 h-6', ...props }),
            RefreshCw: (props) => React.createElement(window.getIcon('RefreshCw'), { className: 'w-6 h-6', ...props }),
            ChevronDown: (props) => React.createElement(window.getIcon('ChevronDown'), { className: 'w-3 h-3 text-slate-400', ...props }),
            Check: (props) => React.createElement(window.getIcon('Check'), { className: 'w-4 h-4', ...props }),
            Share2: (props) => React.createElement(window.getIcon('Share2'), { className: 'w-4 h-4', ...props }),
            Copy: (props) => React.createElement(window.getIcon('Copy'), { className: 'w-4 h-4', ...props }),
            Menu: (props) => React.createElement(window.getIcon('Menu'), { className: 'w-6 h-6', ...props }),
            X: (props) => React.createElement(window.getIcon('X'), { className: 'w-6 h-6', ...props }),
            Home: (props) => React.createElement(window.getIcon('Home'), { className: 'w-5 h-5', ...props }),
            GlassWater: (props) => React.createElement(window.getIcon('GlassWater'), { className: 'w-5 h-5', ...props }),
            MapIcon: (props) => React.createElement(window.getIcon('Map'), { className: 'w-5 h-5', ...props }),
            Car: (props) => React.createElement(window.getIcon('Car'), { className: 'w-5 h-5', ...props }),
            Backpack: (props) => React.createElement(window.getIcon('Backpack'), { className: 'w-5 h-5', ...props }),
        };
    </script>
    <script>
        window.dataLayer = window.dataLayer || [];
        window.logEvent = function (event, params) {
            try {
                window.dataLayer.push(Object.assign({ event: event }, params || {}));
            } catch (e) { }
        };
    </script>
    <script>
        (function () {
            class AdmaxSlot extends HTMLElement {
                connectedCallback() {
                    if (this._loaded) return;
                    this._loaded = true;
                    const root = this.attachShadow({ mode: 'open' });
                    const wrap = document.createElement('div');
                    wrap.style.minHeight = '60px';
                    wrap.style.display = 'flex';
                    wrap.style.flexDirection = 'column';
                    wrap.style.alignItems = 'center';
                    const label = document.createElement('div');
                    label.textContent = 'ã‚¹ãƒãƒ³ã‚µãƒ¼ãƒªãƒ³ã‚¯';
                    label.style.fontSize = '0.75rem';
                    label.style.color = '#9ca3af';
                    label.style.marginBottom = '0.5rem';
                    const s = document.createElement('script');
                    s.src = 'https://adm.shinobi.jp/s/4ad8d351097023368734c13dc79d1a20';
                    s.async = true;
                    wrap.appendChild(label);
                    wrap.appendChild(s);
                    root.appendChild(wrap);
                }
            }
            if (!customElements.get('admax-slot')) {
                customElements.define('admax-slot', AdmaxSlot);
            }
        })();
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const { Wallet, Users, Plus, Trash2, ChevronDown, Check, RefreshCw, Share2, Copy, Menu, X, Home, GlassWater, MapIcon, Car, Backpack } = window.Icons;

        const WEIGHTS = {
            VERY_HIGH: { label: 'å¤šã‚', value: 1.4 },
            HIGH: { label: 'ã‚„ã‚„å¤šã‚', value: 1.2 },
            NORMAL: { label: 'æ™®é€š', value: 1.0 },
            LOW: { label: 'ã‚„ã‚„å°‘ãªã„', value: 0.8 },
            VERY_LOW: { label: 'å°‘ãªã„', value: 0.6 }
        };

        const App = () => {
            const [totalAmount, setTotalAmount] = useState(0);
            const [members, setMembers] = useState([
                { id: '1', name: 'ãƒ¡ãƒ³ãƒãƒ¼1', weight: 'NORMAL' },
                { id: '2', name: 'ãƒ¡ãƒ³ãƒãƒ¼2', weight: 'NORMAL' }
            ]);
            const [prepayments, setPrepayments] = useState([]);
            const [splitStyle, setSplitStyle] = useState('500'); // Unit in string
            const [calcMode, setCalcMode] = useState('surplus'); // 'surplus' (Round Up) or 'exact' (Exact Match)
            const [isMenuOpen, setIsMenuOpen] = useState(false);

            // è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
            const results = useMemo(() => {
                if (totalAmount <= 0 || members.length === 0) return [];

                // å…ˆæ‰•ã„ã®åˆè¨ˆ
                const totalPrepaid = prepayments.reduce((sum, p) => sum + p.amount, 0);
                // å‰²ã‚Šå‹˜å¯¾è±¡é¡ (è² ã®æ•°ã«ãªã‚‰ãªã„ã‚ˆã†ã«èª¿æ•´)
                const remainingToSplit = Math.max(0, totalAmount - totalPrepaid);

                // åˆè¨ˆé‡ã¿
                const totalWeight = members.reduce((sum, m) => sum + WEIGHTS[m.weight].value, 0);
                const unit = Number(splitStyle);

                // å„ãƒ¡ãƒ³ãƒãƒ¼ã®è² æ‹…é¡ç®—å‡º
                const memberResults = members.map(member => {
                    const weightValue = WEIGHTS[member.weight].value;
                    // æŒ‡å®šå˜ä½ã§åˆ‡ã‚Šä¸Šã’
                    const splitShare = totalWeight > 0 ? Math.ceil((remainingToSplit * (weightValue / totalWeight)) / unit) * unit : 0;

                    // ãã®ãƒ¡ãƒ³ãƒãƒ¼ãŒå…ˆæ‰•ã„ã—ã¦ã„ãŸåˆè¨ˆé¡
                    const memberPrepaid = prepayments
                        .filter((p, idx) => (p.name || `å…ˆæ‰•ã„${idx + 1}`) === member.name)
                        .reduce((sum, p) => sum + p.amount, 0);

                    // æœ€çµ‚çš„ãªåæ”¯: è² æ‹…é¡ -  ìì‹ ì´ å…ˆæ‰•ã„ã—ãŸé¡
                    // æ­£ãªã‚‰ã€Œæ‰•ã†ã€ã€è² ãªã‚‰ã€Œã‚‚ã‚‰ã†ã€
                    const settlement = splitShare - memberPrepaid;

                    return {
                        ...member,
                        share: splitShare,
                        memberPrepaid, // ãƒ‡ãƒãƒƒã‚°/è¡¨ç¤ºç”¨
                        settlement
                    };
                });

                // ãƒ¢ãƒ¼ãƒ‰åˆ¥ã®èª¿æ•´
                let finalSurplus = 0;
                if (calcMode === 'exact' && memberResults.length > 0) {
                    // å…¨å“¡ã®è² æ‹…é¡åˆè¨ˆ
                    const currentTotalShares = memberResults.reduce((sum, r) => sum + r.share, 0);
                    // èª¤å·®
                    const diff = currentTotalShares - remainingToSplit;

                    if (diff !== 0) {
                        // æœ€åˆã®ä¸€äººï¼ˆå¹¹äº‹å½¹ï¼‰ã§èª¿æ•´
                        memberResults[0].share -= diff;
                        memberResults[0].settlement -= diff;
                    }
                    finalSurplus = 0;
                } else {
                    // ãŠé‡£ã‚Šã®è¨ˆç®—
                    const totalShares = memberResults.reduce((sum, r) => sum + r.share, 0);
                    finalSurplus = Math.max(0, totalShares - remainingToSplit);
                }

                // ãƒ¡ãƒ³ãƒãƒ¼ãƒªã‚¹ãƒˆã«ã¯ã„ãªã„ãŒã€å…ˆæ‰•ã„ã ã‘ã—ãŸäººã®æŠ½å‡º
                const externalPrepayers = prepayments
                    .filter((p, idx) => !members.some(m => m.name === (p.name || `å…ˆæ‰•ã„${idx + 1}`)))
                    .reduce((acc, p, idx) => {
                        const displayName = p.name || `å…ˆæ‰•ã„${idx + 1}`;
                        const existing = acc.find(a => a.name === displayName);
                        if (existing) {
                            existing.amount += p.amount;
                        } else {
                            acc.push({ name: displayName, amount: p.amount });
                        }
                        return acc;
                    }, [])
                    .map(ep => ({
                        id: `ext-${ep.name}`,
                        name: ep.name,
                        share: 0,
                        memberPrepaid: ep.amount,
                        settlement: -ep.amount // å…¨é¡ã€Œã‚‚ã‚‰ã†ã€
                    }));

                const finalResults = [...memberResults, ...externalPrepayers];

                // ãŠé‡£ã‚Šã®è¨ˆç®—
                const totalShares = memberResults.reduce((sum, r) => sum + r.share, 0);
                const surplus = totalShares - remainingToSplit;

                return {
                    list: finalResults,
                    surplus: finalSurplus
                };
            }, [totalAmount, members, prepayments, splitStyle, calcMode]);

            const sumPrepaid = useMemo(() => prepayments.reduce((sum, p) => sum + p.amount, 0), [prepayments]);
            const remainingToSplit = Math.max(0, totalAmount - sumPrepaid);
            const displayResults = results.list || [];
            const surplusAmount = results.surplus || 0;

            const addMember = () => {
                const newId = Math.random().toString(36).substr(2, 9);
                setMembers([...members, { id: newId, name: `ãƒ¡ãƒ³ãƒãƒ¼${members.length + 1}`, weight: 'NORMAL' }]);
                window.logEvent('member_add', { count: members.length + 1 });
            };

            const addPrepayment = () => {
                const newId = Math.random().toString(36).substr(2, 9);
                setPrepayments([...prepayments, { id: newId, name: `å…ˆæ‰•ã„${prepayments.length + 1}`, amount: 0 }]);
                window.logEvent('prepayment_add', { count: prepayments.length + 1 });
            };

            const removeMember = (id) => {
                if (members.length > 1) {
                    setMembers(members.filter(m => m.id !== id));
                    window.logEvent('member_remove', { count: members.length - 1 });
                }
            };

            const removePrepayment = (id) => {
                setPrepayments(prepayments.filter(p => p.id !== id));
                window.logEvent('prepayment_remove', { count: Math.max(0, prepayments.length - 1) });
            };

            const updateMember = (id, field, value) => {
                setMembers(members.map(m => m.id === id ? { ...m, [field]: value } : m));
            };

            const updatePrepayment = (id, field, value) => {
                setPrepayments(prepayments.map(p => p.id === id ? { ...p, [field]: value } : p));
            };

            const shareResult = () => {
                const text = [
                    "ã€ã‚¹ãƒãƒ¼ãƒˆå‰²ã‚Šå‹˜ã€‘ç²¾ç®—çµæœ",
                    `åˆè¨ˆ: ${totalAmount.toLocaleString()}å††`,
                    ...results.list.filter(r => r.settlement !== 0).map(r =>
                        `${r.name}: ${Math.abs(r.settlement).toLocaleString()}å††ã‚’${r.settlement > 0 ? 'æ‰•ã†' : 'ã‚‚ã‚‰ã†'}`
                    ),
                    surplusAmount > 0 ? `ãŠé‡£ã‚Š: ${surplusAmount.toLocaleString()}å††` : "",
                    "",
                    "è¨ˆç®—ã¯ã“ã¡ã‚‰:",
                    window.location.href
                ].join('\n');

                if (navigator.share) {
                    navigator.share({ text }).catch(() => { });
                } else {
                    navigator.clipboard.writeText(text);
                    alert('ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
                }
            };

            const NavMenu = () => (
                <div className={`fixed inset-0 z-[100] transition-all duration-500 ${isMenuOpen ? 'visible' : 'invisible'}`}>
                    {/* Overlay */}
                    <div
                        className={`absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity duration-500 ${isMenuOpen ? 'opacity-100' : 'opacity-0'}`}
                        onClick={() => { setIsMenuOpen(false); window.logEvent('menu_close'); }}
                    ></div>
                    {/* Menu Content */}
                    <div className={`absolute right-0 top-0 bottom-0 w-[280px] bg-white shadow-2xl transition-transform duration-500 transform ${isMenuOpen ? 'translate-x-0' : 'translate-x-full'} flex flex-col`}>
                        <div className="p-6 border-b border-slate-100 flex items-center justify-between">
                            <span className="text-lg font-bold text-slate-900">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</span>
                            <button onClick={() => setIsMenuOpen(false)} className="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-slate-600">
                                <X />
                            </button>
                        </div>
                        <nav className="flex-1 p-4 space-y-2 overflow-y-auto">
                            <a href="index.html" className="flex items-center gap-4 p-4 rounded-2xl bg-indigo-50 text-indigo-700 font-bold">
                                <Home />
                                <span>ãƒ›ãƒ¼ãƒ </span>
                            </a>
                            <a href="golf.html" className="flex items-center justify-between p-4 rounded-2xl hover:bg-slate-50 text-slate-700 font-bold transition-colors">
                                <div className="flex items-center gap-4">
                                    <Car className="text-emerald-500" />
                                    <span>ã‚´ãƒ«ãƒ•ãƒ»ãƒ‰ãƒ©ã‚¤ãƒ–ç²¾ç®—</span>
                                </div>
                                <span className="bg-emerald-500 text-white text-[10px] px-2 py-0.5 rounded-full uppercase tracking-widest">New</span>
                            </a>
                            <div className="flex items-center justify-between p-4 rounded-2xl text-slate-300 font-bold cursor-not-allowed">
                                <div className="flex items-center gap-4">
                                    <GlassWater />
                                    <span>åˆã‚³ãƒ³ãƒ»é£²ã¿ä¼šç²¾ç®—</span>
                                </div>
                                <span className="text-[10px] border border-slate-200 px-2 py-0.5 rounded-full uppercase tracking-widest">Soon</span>
                            </div>
                            <a href="travel.html" className="flex items-center justify-between p-4 rounded-2xl hover:bg-slate-50 text-slate-700 font-bold transition-colors">
                                <div className="flex items-center gap-4">
                                    <Backpack className="text-orange-500" />
                                    <span>æ—…è¡Œãƒ»ã‚­ãƒ£ãƒ³ãƒ—ç²¾ç®—</span>
                                </div>
                                <span className="bg-orange-500 text-white text-[10px] px-2 py-0.5 rounded-full uppercase tracking-widest">New</span>
                            </a>
                        </nav>
                        <div className="p-8 border-t border-slate-50">
                            <p className="text-[10px] text-slate-400 font-bold text-center uppercase tracking-widest">
                                Smart Warikan v2.0
                            </p>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-[#F8F9FC] pb-32 font-sans text-slate-900 overflow-x-hidden">
                    <NavMenu />
                    {/* Header */}
                    <header className="bg-white/90 backdrop-blur-xl sticky top-0 z-50 border-b border-slate-200 py-4 px-6 flex items-center justify-between shadow-sm ring-1 ring-slate-100">
                        <div className="flex items-center gap-3">
                            <div className="bg-gradient-to-br from-indigo-600 to-indigo-800 p-2.5 rounded-2xl shadow-indigo-200 shadow-xl ring-2 ring-white/20">
                                <Wallet className="text-white w-5 h-5" />
                            </div>
                            <h1 className="text-xl font-bold tracking-tight bg-gradient-to-r from-indigo-600 to-indigo-900 bg-clip-text text-transparent">
                                ã‚¹ãƒãƒ¼ãƒˆå‰²ã‚Šå‹˜
                            </h1>
                        </div>
                        <div className="flex items-center gap-3">
                            <div className="hidden xs:block px-3 py-1 bg-slate-100 rounded-full border border-slate-200">
                                <div className="text-[10px] text-slate-500 font-bold tracking-widest uppercase">Mobile Specialized</div>
                            </div>
                            <button
                                onClick={() => { setIsMenuOpen(true); window.logEvent('menu_open'); }}
                                className="w-12 h-12 flex items-center justify-center text-slate-600 bg-slate-50 rounded-2xl border border-slate-200 active:scale-95 transition-all shadow-sm"
                            >
                                <Menu />
                            </button>
                        </div>
                    </header>

                    <main className="max-w-xl mx-auto space-y-8 p-4 md:p-6 animate-slide-up">
                        {/* 1. åˆè¨ˆé‡‘é¡ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
                        <section className="bg-white rounded-3xl p-6 shadow-premium border border-slate-200 relative overflow-hidden ring-1 ring-slate-100">
                            <div className="absolute top-0 right-0 w-32 h-32 bg-indigo-50 rounded-full -mr-16 -mt-16 -z-10 opacity-50"></div>
                            <label className="block text-xs font-bold text-indigo-500 uppercase tracking-widest mb-3">Total Amount</label>
                            <div className="relative flex items-end">
                                <input
                                    type="number"
                                    inputMode="numeric"
                                    placeholder="0"
                                    className="w-full text-5xl font-bold py-2 border-none focus:ring-0 outline-none transition-colors placeholder:text-slate-200 text-indigo-900 bg-transparent"
                                    value={totalAmount || ''}
                                    onChange={(e) => { const v = Number(e.target.value); setTotalAmount(v); window.logEvent('total_amount_change', { value: v }); }}
                                />
                                <span className="text-2xl font-bold text-slate-400 ml-2 mb-3">å††</span>
                            </div>
                        </section>

                        {/* 2. ã‚¹ã‚¿ã‚¤ãƒ« & å…ˆæ‰•ã„æ¦‚è¦ */}
                        <div className="grid grid-cols-1 gap-4">
                            <section className="bg-slate-200/50 p-1.5 rounded-2xl flex gap-1.5 h-14 ring-1 ring-slate-200/50 overflow-x-auto no-scrollbar">
                                {[10, 100, 500, 1000].map(unit => (
                                    <button
                                        key={unit}
                                        onClick={() => { setSplitStyle(unit.toString()); window.logEvent('split_unit_select', { unit }); }}
                                        className={`flex-1 min-w-[70px] flex items-center justify-center text-sm font-bold rounded-xl transition-all ${splitStyle === unit.toString() ? 'bg-white text-indigo-600 shadow-md scale-[1.02] ring-1 ring-indigo-50' : 'text-slate-500 hover:text-slate-600'}`}
                                    >
                                        {unit}å††
                                    </button>
                                ))}
                            </section>

                            {/* è¨ˆç®—ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ */}
                            <section className="bg-slate-100 p-1 rounded-2xl flex gap-1 h-14 ring-1 ring-slate-200">
                                <button
                                    onClick={() => { setCalcMode('surplus'); window.logEvent('calc_mode_change', { mode: 'surplus' }); }}
                                    className={`flex-1 flex flex-col items-center justify-center rounded-xl transition-all ${calcMode === 'surplus' ? 'bg-white text-indigo-600 shadow-md ring-1 ring-indigo-50' : 'text-slate-400'}`}
                                >
                                    <span className="text-xs font-bold">ä¸è¶³ã‚’å‡ºã•ãªã„</span>
                                    <span className="text-[9px] opacity-60">ï¼ˆåˆ‡ã‚Šä¸Šã’ç²¾ç®—ï¼‰</span>
                                </button>
                                <button
                                    onClick={() => { setCalcMode('exact'); window.logEvent('calc_mode_change', { mode: 'exact' }); }}
                                    className={`flex-1 flex flex-col items-center justify-center rounded-xl transition-all ${calcMode === 'exact' ? 'bg-white text-indigo-600 shadow-md ring-1 ring-indigo-50' : 'text-slate-400'}`}
                                >
                                    <span className="text-xs font-bold">å…¨ä½“ã‚’ãƒ”ãƒƒã‚¿ãƒª</span>
                                    <span className="text-[9px] opacity-60">ï¼ˆåˆè¨ˆé¡ã‚’ä¸€è‡´ï¼‰</span>
                                </button>
                            </section>

                            {sumPrepaid > 0 && (
                                <section className="bg-indigo-50/50 rounded-3xl p-6 border border-indigo-100 flex items-center justify-between shadow-sm">
                                    <div className="space-y-1">
                                        <div className="text-[10px] font-bold text-indigo-500 uppercase tracking-widest"> å¯¾è±¡é¡</div>
                                        <div className="text-2xl font-bold text-indigo-600">{remainingToSplit.toLocaleString()}å††</div>
                                    </div>
                                    <div className="text-right">
                                        <div className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">å…ˆæ‰•ã„è¨ˆ</div>
                                        <div className="text-sm font-bold text-slate-600">{sumPrepaid.toLocaleString()}å††</div>
                                    </div>
                                </section>
                            )}
                        </div>

                        {/* 3. å…ˆæ‰•ã„ç™»éŒ² */}
                        <section>
                            <div className="flex items-center justify-between px-2 mb-4">
                                <h2 className="text-sm font-bold text-slate-800 flex items-center gap-2">
                                    <div className="bg-slate-200 p-1.5 rounded-lg border border-slate-300"><Check className="w-4 h-4 text-slate-700" /></div>
                                    å…ˆæ‰•ã„ç™»éŒ²
                                </h2>
                                <button
                                    onClick={addPrepayment}
                                    className="h-10 px-4 text-sm font-bold text-white bg-gradient-to-br from-indigo-500 to-indigo-700 rounded-2xl shadow-lg shadow-indigo-200 flex items-center gap-2 active:scale-95 transition-all"
                                >
                                    <Plus className="w-4 h-4" /> è¿½åŠ 
                                </button>
                            </div>

                            <div className="space-y-4">
                                {prepayments.map((p) => (
                                    <div key={p.id} className="bg-white rounded-3xl p-4 shadow-sm border border-slate-200 flex items-center gap-3 animate-slide-up ring-1 ring-slate-100">
                                        <input
                                            type="text"
                                            placeholder="åå‰"
                                            className="min-w-0 flex-1 bg-slate-50 border border-slate-200 rounded-2xl h-12 px-4 text-base font-bold text-slate-700 focus:ring-4 focus:ring-indigo-50 focus:border-indigo-200 outline-none transition-all"
                                            value={p.name}
                                            onChange={(e) => { updatePrepayment(p.id, 'name', e.target.value); window.logEvent('prepayment_update', { field: 'name' }); }}
                                        />
                                        <div className="relative w-32 shrink-0">
                                            <input
                                                type="number"
                                                inputMode="numeric"
                                                placeholder="0"
                                                className="w-full bg-slate-50 border border-slate-200 rounded-2xl h-12 pl-4 pr-8 text-base font-bold text-slate-900 focus:ring-4 focus:ring-indigo-50 focus:border-indigo-200 outline-none transition-all"
                                                value={p.amount || ''}
                                                onChange={(e) => { const v = Number(e.target.value); updatePrepayment(p.id, 'amount', v); window.logEvent('prepayment_update', { field: 'amount' }); }}
                                            />
                                            <span className="absolute right-3 top-1/2 -translate-y-1/2 text-xs font-bold text-slate-400">å††</span>
                                        </div>
                                        <button onClick={() => { removePrepayment(p.id); window.logEvent('prepayment_remove'); }} className="w-10 h-10 flex items-center justify-center text-slate-300 hover:text-red-500 transition-colors">
                                            <Trash2 className="w-5 h-5" />
                                        </button>
                                    </div>
                                ))}
                                {prepayments.length === 0 && (
                                    <div className="h-24 flex items-center justify-center border-2 border-dashed border-slate-200 rounded-3xl text-sm font-bold text-slate-300 uppercase tracking-widest bg-slate-50/30">
                                        No Prepayments
                                    </div>
                                )}
                            </div>
                        </section>

                        {/* 4. ãƒ¡ãƒ³ãƒãƒ¼è¨­å®š */}
                        <section>
                            <div className="flex items-center justify-between px-2 mb-4 mt-8">
                                <h2 className="text-sm font-bold text-slate-800 flex items-center gap-2">
                                    <div className="bg-slate-200 p-1.5 rounded-lg border border-slate-300"><Users className="w-4 h-4 text-slate-700" /></div>
                                    ãƒ¡ãƒ³ãƒãƒ¼è¨­å®š
                                </h2>
                                <button
                                    onClick={addMember}
                                    className="h-10 px-4 text-sm font-bold text-indigo-700 bg-indigo-50 rounded-2xl border border-indigo-100 flex items-center gap-2 active:scale-95 transition-all shadow-sm"
                                >
                                    <Plus className="w-4 h-4" /> è¿½åŠ 
                                </button>
                            </div>

                            <div className="space-y-6">
                                {displayResults.filter(r => !r.id.toString().startsWith('ext-')).map((res) => (
                                    <div key={res.id} className="bg-white rounded-[2rem] p-6 shadow-premium border border-slate-200 relative animate-slide-up ring-1 ring-slate-100">
                                        <div className="flex flex-col gap-6">
                                            {/* åå‰ãƒ»é‡‘é¡è¡Œ */}
                                            <div className="flex items-center justify-between gap-4">
                                                <input
                                                    type="text"
                                                    className="min-w-0 flex-1 h-14 bg-slate-50 border border-slate-200 rounded-2xl px-5 text-lg font-bold text-slate-800 focus:ring-4 focus:ring-indigo-50 focus:border-indigo-200 outline-none transition-all"
                                                    value={res.name}
                                                    onChange={(e) => { updateMember(res.id, 'name', e.target.value); window.logEvent('member_update', { field: 'name' }); }}
                                                />
                                                <div className="text-right shrink-0">
                                                    <div className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">è² æ‹…é¡</div>
                                                    <div className="text-2xl font-bold bg-gradient-to-br from-indigo-600 to-indigo-800 bg-clip-text text-transparent">
                                                        {res.share.toLocaleString()}<span className="text-xs ml-1 text-slate-400">å††</span>
                                                    </div>
                                                </div>
                                                <button
                                                    onClick={() => { removeMember(res.id); window.logEvent('member_remove'); }}
                                                    disabled={members.length <= 1}
                                                    className="w-10 h-10 flex items-center justify-center text-slate-300 hover:text-red-500 disabled:opacity-0 transition-colors shrink-0"
                                                >
                                                    <Trash2 className="w-5 h-5" />
                                                </button>
                                            </div>

                                            {/* è² æ‹…å‰²åˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆ */}
                                            <div className="bg-slate-100 p-1.5 rounded-2xl flex gap-1.5 overflow-x-auto no-scrollbar ring-1 ring-slate-200">
                                                {Object.entries(WEIGHTS).map(([key, info]) => (
                                                    <button
                                                        key={key}
                                                        onClick={() => { updateMember(res.id, 'weight', key); window.logEvent('member_weight_change', { weight: key }); }}
                                                        className={`shrink-0 flex-1 px-3 py-3 text-xs font-bold rounded-xl transition-all whitespace-nowrap ${res.weight === key ? 'bg-white text-indigo-700 shadow-lg scale-[1.05] z-10 ring-1 ring-indigo-50' : 'text-slate-500 hover:text-slate-600'}`}
                                                    >
                                                        {info.label}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </section>

                        {/* 5. æœ€çµ‚ç²¾ç®— */}
                        {
                            displayResults.some(r => r.settlement !== 0) && (
                                <section className="bg-slate-900 rounded-[3rem] p-8 text-white shadow-2xl shadow-indigo-200 relative overflow-hidden mb-12 ring-2 ring-white/10">
                                    <div className="absolute bottom-0 right-0 w-48 h-48 bg-indigo-500/20 rounded-full -mb-24 -mr-24 blur-3xl"></div>
                                    <div className="absolute top-0 left-0 w-32 h-32 bg-emerald-500/10 rounded-full -mt-16 -ml-16 blur-3xl"></div>
                                    <div className="flex items-center justify-between mb-8 relative z-10">
                                        <h2 className="text-xl font-bold flex items-center gap-3">
                                            <div className="bg-white/10 p-2 rounded-xl backdrop-blur-sm border border-white/10"><RefreshCw className="w-6 h-6 text-indigo-300" /></div>
                                            æœ€çµ‚çš„ãªç²¾ç®—
                                        </h2>
                                        {surplusAmount > 0 && (
                                            <div className="bg-indigo-500/30 border border-indigo-400/30 px-4 py-2 rounded-2xl flex flex-col items-center backdrop-blur-sm">
                                                <span className="text-[10px] font-bold text-indigo-200 uppercase tracking-widest">{calcMode === 'exact' ? 'èª¤å·®' : 'ãŠé‡£ã‚Š'}</span>
                                                <span className="text-lg font-bold">{surplusAmount.toLocaleString()}å††</span>
                                            </div>
                                        )}
                                    </div>
                                    <div className="space-y-6 relative z-10">
                                        {displayResults.filter(r => r.settlement !== 0).map((res) => (
                                            <div key={res.id} className="flex items-center justify-between group py-2 border-b border-white/5 last:border-none">
                                                <div className="space-y-1">
                                                    <div className="flex items-center gap-2">
                                                        <span className="text-base font-bold text-slate-100">{res.name}</span>
                                                        {res.id.toString().startsWith('ext-') && (
                                                            <span className="text-[9px] bg-indigo-500/40 border border-indigo-400/30 px-2 py-0.5 rounded-full font-bold uppercase tracking-tighter text-indigo-100">Prepaid Only</span>
                                                        )}
                                                    </div>
                                                    <div className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Settlement Action</div>
                                                </div>
                                                <div className="text-right">
                                                    <div className={`text-2xl font-bold ${res.settlement > 0 ? 'text-indigo-300' : 'text-emerald-400'}`}>
                                                        {Math.abs(res.settlement).toLocaleString()}
                                                        <span className="text-xs ml-1 opacity-60">å††</span>
                                                    </div>
                                                    <div className={`text-xs font-bold uppercase tracking-widest ${res.settlement > 0 ? 'text-indigo-400' : 'text-emerald-500'}`}>
                                                        {res.settlement > 0 ? 'æ‰•ã†' : 'ã‚‚ã‚‰ã†'}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    <button
                                        onClick={() => { window.logEvent('share_result', { surplus: surplusAmount }); shareResult(); }}
                                        className="mt-8 w-full bg-white/10 hover:bg-white/20 border border-white/20 py-4 rounded-3xl flex items-center justify-center gap-3 font-bold transition-all active:scale-[0.98]"
                                    >
                                        <Share2 className="w-5 h-5 text-indigo-300" />
                                        çµæœã‚’LINEãƒ»ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«å…±æœ‰
                                    </button>
                                    <div className="mt-8 mb-4 flex flex-col items-center min-h-[60px]">
                                        <admax-slot></admax-slot>
                                    </div>
                                </section>
                            )
                        }

                        {/* SEO FAQ Section */}
                        <section className="mt-16 space-y-8 bg-white/50 rounded-[3rem] p-8 border border-slate-200">
                            <h2 className="text-xl font-bold text-slate-800 text-center">ã‚ˆãã‚ã‚‹è³ªå•ã¨å‰²ã‚Šå‹˜ã®ã‚³ãƒ„</h2>
                            <div className="space-y-6">
                                <div className="space-y-2">
                                    <h3 className="font-bold text-indigo-600">Q. ä¸Šå¸ã‚„å…ˆè¼©ãŒå¤šãæ‰•ã†æ™‚ã®è¨ˆç®—æ¯”ç‡ã¯ï¼Ÿ</h3>
                                    <p className="text-sm text-slate-600 leading-relaxed">
                                        ä¸€èˆ¬çš„ã«ã¯ã€Œä¸Šå¸2ï¼šéƒ¨ä¸‹1ã€ã‚„ã€Œå…ˆè¼©1.5ï¼šå¾Œè¼©1ã€ãªã©ã®æ¯”ç‡ãŒã‚¹ãƒãƒ¼ãƒˆã§ã™ã€‚å½“ãƒ„ãƒ¼ãƒ«ã®ã€Œå¤šã‚ã€ã€Œã‚„ã‚„å¤šã‚ã€è¨­å®šã‚’ä½¿ã†ã“ã¨ã§ã€è‡ªå‹•çš„ã«ãã®æ¯”ç‡ã«åˆã‚ã›ãŸç²¾ç®—é¡ã‚’ç®—å‡ºã§ãã¾ã™ã€‚
                                    </p>
                                </div>
                                <div className="space-y-2">
                                    <h3 className="font-bold text-indigo-600">Q. 1å††å˜ä½ã®ç«¯æ•°ãŒå‡ºã‚‹ã®ãŒé¢å€’ãªæ™‚ã¯ï¼Ÿ</h3>
                                    <p className="text-sm text-slate-600 leading-relaxed">
                                        ã€Œ100å††ã€ã‚„ã€Œ500å††ã€ã®å˜ä½è¨­å®šã‚’æ´»ç”¨ã—ã¦ãã ã•ã„ã€‚ç«¯æ•°ã¯è‡ªå‹•çš„ã«åˆ‡ã‚Šä¸Šã’ã‚‰ã‚Œã€ãŠé‡£ã‚Šï¼ˆç«¯æ•°åˆè¨ˆï¼‰ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã“ã®ãŠé‡£ã‚Šã¯å¹¹äº‹ã®æ‰‹é–“è³ƒã¨ã™ã‚‹ã‹ã€æ¬¡å›ã®é›†ã¾ã‚Šã®è³‡é‡‘ã«å›ã™ã®ãŒã‚¹ãƒ ãƒ¼ã‚ºã§ã™ã€‚
                                    </p>
                                </div>
                                <div className="space-y-2">
                                    <h3 className="font-bold text-indigo-600">Q. ã‚´ãƒ«ãƒ•ã‚„æ—…è¡Œã§ã®ã‚¬ã‚½ãƒªãƒ³ä»£ã¯ã©ã†ã™ã‚Œã°ã„ã„ï¼Ÿ</h3>
                                    <p className="text-sm text-slate-600 leading-relaxed">
                                        ã¾ãšåˆè¨ˆé‡‘é¡ã‚’å…¥åŠ›ã—ã€é‹è»¢æ‰‹ã®æ–¹ã‚’ã€Œå°‘ãªã„ã€è¨­å®šã«ã™ã‚‹ã‹ã€ã‚¬ã‚½ãƒªãƒ³ä»£ç›¸å½“ã‚’ã€Œå…ˆæ‰•ã„ã€ã¨ã—ã¦ç™»éŒ²ã™ã‚‹ã“ã¨ã§ã€é‹è»¢æ‰‹ã®å®Ÿè³ªçš„ãªè² æ‹…ã‚’è»½æ¸›ã™ã‚‹èª¿æ•´ãŒå¯èƒ½ã§ã™ã€‚
                                    </p>
                                </div>
                            </div>
                        </section>
                    </main >

                    {/* Fixed Summary Bottom bar */}
                    {
                        totalAmount > 0 && (
                            <div className="fixed bottom-6 left-4 right-4 z-50 animate-slide-up">
                                <div className="glass-card shadow-2xl rounded-3xl p-5 flex items-center justify-between max-w-lg mx-auto">
                                    <div className="space-y-0.5">
                                        <div className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Total Summary</div>
                                        <div className="text-xl font-bold text-indigo-600">{totalAmount.toLocaleString()}å††</div>
                                    </div>
                                    <button
                                        onClick={() => { window.logEvent('scroll_to_results'); window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }); }}
                                        className="bg-slate-900 text-white px-6 py-3 rounded-2xl text-sm font-bold shadow-lg active:scale-95 transition-all flex items-center gap-2"
                                    >
                                        çµæœã‚’è¦‹ã‚‹ <ChevronDown className="w-4 h-4 opacity-50 rotate-[270deg]" />
                                    </button>
                                </div>
                            </div>
                        )
                    }

                    <footer className="pb-32 pt-12 text-center text-slate-400 text-[10px] items-center flex flex-col gap-3">
                        <div className="w-12 h-1.5 bg-slate-200 rounded-full"></div>
                        <span className="font-bold tracking-widest uppercase">&copy; 2026 Smart Warikan Tool â€¢ Premium Mobile Design</span>
                    </footer>
                </div >
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>
